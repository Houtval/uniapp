"use strict";const i=require("../../../../common/vendor.js"),n=require("../../../uv-ui-tools/libs/mixin/mpMixin.js"),h=require("../../../uv-ui-tools/libs/mixin/mixin.js"),d=require("./props.js");require("../../../uv-ui-tools/libs/function/index.js");require("../../../uv-ui-tools/libs/function/test.js");require("../../../uv-ui-tools/libs/function/digit.js");const a={name:"uv-image",emits:["click","load","error"],mixins:[n.mpMixin,h.mixin,d.props],data(){return{isError:!1,loading:!0,backgroundStyle:{},show:!1,observeShow:!this.observeLazyLoad,elIndex:"",imgWidth:this.width,imgHeight:this.height,thresholdValue:50}},watch:{src:{immediate:!0,handler(e){e?(this.isError=!1,this.loading=!0):this.isError=!0}}},computed:{wrapStyle(){let e={};return e.width=this.$uv.addUnit(this.imgWidth),e.height=this.$uv.addUnit(this.imgHeight),e.borderRadius=this.shape=="circle"?"10000px":this.$uv.addUnit(this.radius),e.overflow=this.radius>0?"hidden":"visible",this.$uv.deepMerge(e,this.$uv.addStyle(this.customStyle))},imageStyle(){let e={};return e.borderRadius=this.shape=="circle"?"10000px":this.$uv.addUnit(this.radius),e}},created(){this.elIndex=this.$uv.guid(),this.observer={},this.observerName="lazyLoadContentObserver"},mounted(){this.show=!0,this.observeLazyLoad&&this.observerFn()},methods:{onClick(){this.$emit("click")},onErrorHandler(e){this.loading=!1,this.isError=!0,this.$emit("error",e)},onLoadHandler(e){this.mode=="widthFix"&&(this.imgHeight="auto"),this.mode=="heightFix"&&(this.imgWidth="auto"),this.loading=!1,this.isError=!1,this.$emit("load",e),this.removeBgColor()},removeBgColor(){this.backgroundStyle={backgroundColor:"transparent"}},observerFn(){this.$nextTick(()=>{i.index.$once("onLazyLoadReachBottom",()=>{this.observeShow||(this.observeShow=!0)})}),setTimeout(()=>{this.disconnectObserver(this.observerName);const e=i.index.createIntersectionObserver(this);e.relativeToViewport({bottom:this.thresholdValue}).observe(`.uv-image--${this.elIndex}`,s=>{s.intersectionRatio>0&&(this.observeShow=!0,this.disconnectObserver(this.observerName))}),this[this.observerName]=e},50)},disconnectObserver(e){const s=this[e];s&&s.disconnect()}}};if(!Array){const e=i.resolveComponent("uv-icon"),s=i.resolveComponent("uv-transition");(e+s)()}const u=()=>"../../../uv-icon/components/uv-icon/uv-icon.js",l=()=>"../../../uv-transition/components/uv-transition/uv-transition.js";Math||(u+l)();function m(e,s,g,c,r,o){return i.e({a:!r.isError&&r.observeShow},!r.isError&&r.observeShow?{b:e.src,c:e.mode,d:i.o((...t)=>o.onErrorHandler&&o.onErrorHandler(...t)),e:i.o((...t)=>o.onLoadHandler&&o.onLoadHandler(...t)),f:e.showMenuByLongpress,g:e.lazyLoad,h:i.s(o.imageStyle)}:{},{i:e.showLoading&&r.loading},e.showLoading&&r.loading?{j:i.p({name:e.loadingIcon,width:e.width,height:e.height}),k:e.shape=="circle"?"50%":e.$uv.addUnit(e.radius),l:e.bgColor,m:e.$uv.addUnit(e.width),n:e.$uv.addUnit(e.height)}:{},{o:e.showError&&r.isError&&!r.loading},e.showError&&r.isError&&!r.loading?{p:i.p({name:e.errorIcon,width:e.width,height:e.height}),q:e.shape=="circle"?"50%":e.$uv.addUnit(e.radius),r:e.$uv.addUnit(e.width),s:e.$uv.addUnit(e.height)}:{},{t:i.n(`uv-image--${r.elIndex}`),v:i.o((...t)=>o.onClick&&o.onClick(...t)),w:i.s(o.wrapStyle),x:i.s(r.backgroundStyle),y:i.p({show:r.show,mode:"fade",duration:e.fade?e.duration:0})})}const v=i._export_sfc(a,[["render",m],["__scopeId","data-v-8fe9e33e"],["__file","D:/imformation/uni-app/stm32/uni_modules/uv-image/components/uv-image/uv-image.vue"]]);wx.createComponent(v);

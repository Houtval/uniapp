"use strict";const g=require("../../../uv-ui-tools/libs/mixin/mpMixin.js"),y=require("../../../uv-ui-tools/libs/mixin/mixin.js"),$=require("./props.js"),u=require("./valid.js"),x=require("../../../../common/vendor.js");require("../../../uv-ui-tools/libs/function/index.js");require("../../../uv-ui-tools/libs/function/test.js");require("../../../uv-ui-tools/libs/function/digit.js");u.Schema.warning=function(){};const b={name:"uv-form",mixins:[g.mpMixin,y.mixin,$.props],provide(){return{uForm:this}},data(){return{formRules:{},validator:{},originalModel:null}},watch:{rules:{immediate:!0,handler(e){this.setRules(e)}},propsChange(e){var t;(t=this.children)!=null&&t.length&&this.children.map(r=>{typeof r.updateParentData=="function"&&r.updateParentData()})},model:{immediate:!0,handler(e){this.originalModel||(this.originalModel=this.$uv.deepClone(e))}}},computed:{propsChange(){return[this.errorType,this.borderBottom,this.labelPosition,this.labelWidth,this.labelAlign,this.labelStyle]}},created(){this.children=[]},methods:{setRules(e){if(Object.keys(e).length!==0){if(Object.keys(this.model).length===0){this.$uv.error("设置rules，model必须设置！如果已经设置，请刷新页面。");return}this.formRules=e,this.validator=new u.Schema(e)}},resetFields(){this.resetModel()},resetModel(e){this.children.map(t=>{const r=t==null?void 0:t.prop,o=this.$uv.getProperty(this.originalModel,r);this.$uv.setProperty(this.model,r,o)})},clearValidate(e){e=[].concat(e),this.children.map(t=>{(e[0]===void 0||e.includes(t.prop))&&(t.message=null)})},async validateField(e,t,r=null){this.$nextTick(()=>{const o=[];e=[].concat(e),this.children.map(i=>{const s=[];if(e.includes(i.prop)){const _=this.$uv.getProperty(this.model,i.prop),m=i.prop.split("."),c=m[m.length-1],p=this.formRules[i.prop];if(!p)return;const h=[].concat(p);for(let l=0;l<h.length;l++){const n=h[l],v=[].concat(n==null?void 0:n.trigger);if(r&&!v.includes(r))continue;new u.Schema({[c]:n}).validate({[c]:_},(a,P)=>{var d,f;this.$uv.test.array(a)&&(o.push(...a),s.push(...a)),i.message=(d=s[0])!=null&&d.message?(f=s[0])==null?void 0:f.message:null})}}}),typeof t=="function"&&t(o)})},validate(e){if(Object.keys(this.formRules).length===0){this.$uv.error("未设置rules，请看文档说明！如果已经设置，请刷新页面。");return}return new Promise((t,r)=>{this.$nextTick(()=>{const o=this.children.map(i=>i.prop);this.validateField(o,i=>{i.length?(this.errorType==="toast"&&this.$uv.toast(i[0].message),r(i)):t(!0)})})})}}};function q(e,t,r,o,i,s){return{}}const F=x._export_sfc(b,[["render",q],["__file","D:/imformation/uni-app/stm32/uni_modules/uv-form/components/uv-form/uv-form.vue"]]);wx.createComponent(F);

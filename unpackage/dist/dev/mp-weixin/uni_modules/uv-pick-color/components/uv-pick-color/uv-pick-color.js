"use strict";const b=require("../../../uv-ui-tools/libs/mixin/mpMixin.js"),a=require("../../../uv-ui-tools/libs/mixin/mixin.js"),l=require("./colors.js"),u=require("./props.js"),e=require("../../../../common/vendor.js");require("../../../uv-ui-tools/libs/function/index.js");require("../../../uv-ui-tools/libs/function/test.js");require("../../../uv-ui-tools/libs/function/digit.js");const p={name:"uv-pick-color",emits:["confirm","cancel","close","change"],mixins:[b.mpMixin,a.mixin,u.props],computed:{pointerStyle(){const t={};return t.top=this.$uv.addUnit(this.site[0].top-8),t.left=this.$uv.addUnit(this.site[0].left-8),t}},data(){return{showToolbar:!1,rgba:{r:0,g:0,b:0,a:1},hsb:{h:0,s:0,b:0},site:[{top:0,left:0},{left:0},{left:0}],index:0,bgcolor:{r:255,g:0,b:0,a:1},hex:"#000000",mode:!0,colorList:l.colorList}},watch:{prefabColor(t){this.colorList=t}},created(){this.rgba=this.color,this.prefabColor.length&&(this.colorList=this.prefabColor)},methods:{open(){this.$refs.pickerColorPopup.open(),this.showToolbar=!0,this.$nextTick(async()=>{await this.$uv.sleep(350),this.getSelectorQuery()})},close(){this.$refs.pickerColorPopup.close()},popupChange(t){t.show||this.$emit("close")},cancelHandler(){this.$emit("cancel"),this.close()},confirmHandler(){this.$emit("confirm",{rgba:this.rgba,hex:this.hex}),this.close()},init(){this.hsb=l.rgbToHsb(this.rgba),this.setValue(this.rgba)},async getSelectorQuery(){const t=await this.$uvGetRect(".drag-box",!0);this.position=t,this.setColorBySelect(this.rgba)},select(){this.mode=!this.mode},touchstart(t,h){const{pageX:r,pageY:c}=t.touches[0];this.pageX=r,this.pageY=c,this.setPosition(r,c,h)},touchmove(t,h){const{pageX:r,pageY:c}=t.touches[0];this.moveX=r,this.moveY=c,this.setPosition(r,c,h)},touchend(t,h){},setPosition(t,h,r){this.index=r;const{top:c,left:s,width:i,height:o}=this.position[r];this.site[r].left=Math.max(0,Math.min(parseInt(t-s),i)),r===0?(this.site[r].top=Math.max(0,Math.min(parseInt(h-c),o)),this.hsb.s=parseInt(100*this.site[r].left/i),this.hsb.b=parseInt(100-100*this.site[r].top/o),this.setColor(),this.setValue(this.rgba)):this.setControl(r,this.site[r].left)},setColor(){const t=l.hsbToRgb(this.hsb);this.rgba.r=t.r,this.rgba.g=t.g,this.rgba.b=t.b},setValue(t){this.hex=`#${l.rgbToHex(t)}`},setControl(t,h){const{top:r,left:c,width:s,height:i}=this.position[t];t===1?(this.hsb.h=parseInt(360*h/s),this.bgcolor=l.hsbToRgb({h:this.hsb.h,s:100,b:100}),this.setColor()):this.rgba.a=+(h/s).toFixed(1),this.setValue(this.rgba)},setColorBySelect(t){const{r:h,g:r,b:c,a:s}=t;let i={};i={r:h?parseInt(h):0,g:r?parseInt(r):0,b:c?parseInt(c):0,a:s||0},this.rgba=i,this.hsb=l.rgbToHsb(i),this.changeViewByHsb()},changeViewByHsb(){const[t,h,r]=this.position;this.site[0].left=parseInt(this.hsb.s*t.width/100),this.site[0].top=parseInt((100-this.hsb.b)*t.height/100),this.setColor(this.hsb.h),this.setValue(this.rgba),this.bgcolor=l.hsbToRgb({h:this.hsb.h,s:100,b:100}),this.site[1].left=this.hsb.h/360*h.width,this.site[2].left=this.rgba.a*r.width}}};if(!Array){const t=e.resolveComponent("uv-toolbar"),h=e.resolveComponent("uv-popup");(t+h)()}const g=()=>"../../../uv-picker/components/uv-toolbar/uv-toolbar.js",m=()=>"../../../uv-popup/components/uv-popup/uv-popup.js";Math||(g+m)();function f(t,h,r,c,s,i){return e.e({a:e.o(i.cancelHandler),b:e.o(i.confirmHandler),c:e.p({show:s.showToolbar,cancelColor:t.cancelColor,confirmColor:t.confirmColor,cancelText:t.cancelText,confirmText:t.confirmText,title:t.title,["show-border"]:!0}),d:e.s(i.pointerStyle),e:e.o(o=>i.touchstart(o,0)),f:e.o(o=>i.touchmove(o,0)),g:e.o(o=>i.touchend(o,0)),h:`rgb(${s.bgcolor.r},${s.bgcolor.g},${s.bgcolor.b})`,i:`rgba(${s.rgba.r},${s.rgba.g},${s.rgba.b},${s.rgba.a})`,j:t.$uv.getPx(s.site[1].left-10,!0),k:e.o(o=>i.touchstart(o,1)),l:e.o(o=>i.touchmove(o,1)),m:e.o(o=>i.touchend(o,1)),n:t.$uv.getPx(s.site[2].left-10,!0),o:e.o(o=>i.touchstart(o,2)),p:e.o(o=>i.touchmove(o,2)),q:e.o(o=>i.touchend(o,2)),r:e.o((...o)=>i.select&&i.select(...o)),s:s.mode},s.mode?{t:e.t(s.hex)}:{v:e.t(s.rgba.r),w:e.t(s.rgba.g),x:e.t(s.rgba.b),y:e.t(s.rgba.a)},{z:e.f(s.colorList,(o,n,_)=>({a:`rgba(${o.r},${o.g},${o.b},${o.a})`,b:e.o(C=>i.setColorBySelect(o),n),c:n})),A:e.sr("pickerColorPopup","cddb40bb-0"),B:e.o(i.popupChange),C:e.p({mode:"bottom",["close-on-click-overlay"]:t.closeOnClickOverlay})})}const v=e._export_sfc(p,[["render",f],["__scopeId","data-v-cddb40bb"],["__file","D:/imformation/uni-app/stm32/uni_modules/uv-pick-color/components/uv-pick-color/uv-pick-color.vue"]]);wx.createComponent(v);
